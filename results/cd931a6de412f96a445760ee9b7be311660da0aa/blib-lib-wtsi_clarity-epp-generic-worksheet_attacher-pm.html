<!DOCTYPE html
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<!--
This file was generated by Devel::Cover Version 1.21
Devel::Cover is copyright 2001-2012, Paul Johnson (paul@pjcj.net)
Devel::Cover is free. It is licensed under the same terms as Perl itself.
The latest version of Devel::Cover should be available from my homepage:
http://www.pjcj.net
-->
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
    <meta http-equiv="Content-Language" content="en-us"></meta>
    <link rel="stylesheet" type="text/css" href="cover.css"></link>
    <link rel="stylesheet" type="text/css" href="cover.css"></link>
    <title>File Coverage: blib/lib/wtsi_clarity/epp/generic/worksheet_attacher.pm</title>
</head>
<body>
<h1>File Coverage</h1>
<table>
<tr><td class="h" align="right">File:</td><td align="left">blib/lib/wtsi_clarity/epp/generic/worksheet_attacher.pm</td></tr>
<tr><td class="h" align="right">Coverage:</td><td align="left" class="c2">92.2%</td></tr>
</table>
<div><br/></div>
<table>
<tr><th>line</th><th>stmt</th><th>bran</th><th>cond</th><th>sub</th><th>pod</th><th>time</th><th>code</th></tr>
<tr><td class="h">1</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">package wtsi_clarity::epp::generic::worksheet_attacher;</td></tr>
<tr><td class="h">2</td><td colspan="7"></td></tr><tr><td class="h">3</td><td><div class="c3">3</div><div class="c3">3</div><div class="c3">3</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-wtsi_clarity-epp-generic-worksheet_attacher-pm--subroutine.html#L3">3</a></div></td><td></td><td><div>5203</div><div>5</div><div>17</div></td><td class="s">use Moose;</td></tr>
<tr><td class="h">4</td><td><div class="c3">3</div><div class="c3">3</div><div class="c3">3</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-wtsi_clarity-epp-generic-worksheet_attacher-pm--subroutine.html#L4">3</a></div></td><td></td><td><div>11534</div><div>3</div><div>124</div></td><td class="s">use Carp;</td></tr>
<tr><td class="h">5</td><td><div class="c3">3</div><div class="c3">3</div><div class="c3">3</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-wtsi_clarity-epp-generic-worksheet_attacher-pm--subroutine.html#L5">3</a></div></td><td></td><td><div>9</div><div>4</div><div>72</div></td><td class="s">use Readonly;</td></tr>
<tr><td class="h">6</td><td><div class="c3">3</div><div class="c3">3</div><div class="c3">3</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-wtsi_clarity-epp-generic-worksheet_attacher-pm--subroutine.html#L6">3</a></div></td><td></td><td><div>8</div><div>1</div><div>38</div></td><td class="s">use DateTime;</td></tr>
<tr><td class="h">7</td><td><div class="c3">3</div><div class="c3">3</div><div class="c3">3</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-wtsi_clarity-epp-generic-worksheet_attacher-pm--subroutine.html#L7">3</a></div></td><td></td><td><div>7</div><div>3</div><div>15</div></td><td class="s">use POSIX;</td></tr>
<tr><td class="h">8</td><td><div class="c3">3</div><div class="c3">3</div><div class="c3">3</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-wtsi_clarity-epp-generic-worksheet_attacher-pm--subroutine.html#L8">3</a></div></td><td></td><td><div>4181</div><div>25845</div><div>87</div></td><td class="s">use Mojo::Collection;</td></tr>
<tr><td class="h">9</td><td><div class="c3">3</div><div class="c3">3</div><div class="c3">3</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-wtsi_clarity-epp-generic-worksheet_attacher-pm--subroutine.html#L9">3</a></div></td><td></td><td><div>898</div><div>4</div><div>52</div></td><td class="s">use wtsi_clarity::util::request;</td></tr>
<tr><td class="h">10</td><td><div class="c3">3</div><div class="c3">3</div><div class="c3">3</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-wtsi_clarity-epp-generic-worksheet_attacher-pm--subroutine.html#L10">3</a></div></td><td></td><td><div>673</div><div>3</div><div>6794</div></td><td class="s">use wtsi_clarity::util::well_mapper;</td></tr>
<tr><td class="h">11</td><td colspan="7"></td></tr><tr><td class="h">12</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">extends qw/ wtsi_clarity::epp</td></tr>
<tr><td class="h">13</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;wtsi_clarity::util::pdf::pdf_generator</td></tr>
<tr><td class="h">14</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;/;</td></tr>
<tr><td class="h">15</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">with qw/ wtsi_clarity::util::clarity_elements_fetcher_role_util</td></tr>
<tr><td class="h">16</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;wtsi_clarity::util::clarity_elements</td></tr>
<tr><td class="h">17</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;wtsi_clarity::util::uploader_role</td></tr>
<tr><td class="h">18</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;/;</td></tr>
<tr><td class="h">19</td><td colspan="7"></td></tr><tr><td class="h">20</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">our $VERSION = &#39;1.14-rc-131-gcd931a6&#39;;</td></tr>
<tr><td class="h">21</td><td colspan="7"></td></tr><tr><td class="h">22</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">## no critic(ValuesAndExpressions::RequireInterpolationOfMetachars)</td></tr>
<tr><td class="h">23</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">Readonly::Scalar my $ARTIFACT_PATH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; q(/prc:process/input-output-map/input/@post-process-uri);</td></tr>
<tr><td class="h">24</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">Readonly::Scalar my $PREVIOUS_PROC&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; q(/prc:process/input-output-map/input/parent-process/@uri);</td></tr>
<tr><td class="h">25</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">Readonly::Scalar my $PROCESS_ID_PATH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; q(/prc:process/@limsid);</td></tr>
<tr><td class="h">26</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">Readonly::Scalar my $TECHNICIAN_FIRSTNAME_PATH =&gt; q(/prc:process/technician/first-name/text());</td></tr>
<tr><td class="h">27</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">Readonly::Scalar my $TECHNICIAN_LASTNAME_PATH&nbsp;&nbsp;=&gt; q(/prc:process/technician/last-name/text());</td></tr>
<tr><td class="h">28</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">Readonly::Scalar my $LOCATION_PATH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; q(/art:artifact/location/value);</td></tr>
<tr><td class="h">29</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">Readonly::Scalar my $CONTAINER_URI_PATH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; q(/art:artifact/location/container/@uri);</td></tr>
<tr><td class="h">30</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">Readonly::Scalar my $CONTAINER_ID_PATH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; q(/art:artifact/location/container/@limsid);</td></tr>
<tr><td class="h">31</td><td colspan="7"></td></tr><tr><td class="h">32</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">Readonly::Scalar my $CONTAINER_TYPE_URI&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; q{/con:container/type/@uri};</td></tr>
<tr><td class="h">33</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">Readonly::Scalar my $CONTAINER_TYPE_NAME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; q{/con:container/type/@name};</td></tr>
<tr><td class="h">34</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">Readonly::Scalar my $CONTAINER_TYPE_X&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; q{/ctp:container-type/x-dimension/size};</td></tr>
<tr><td class="h">35</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">Readonly::Scalar my $CONTAINER_TYPE_Y&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; q{/ctp:container-type/y-dimension/size};</td></tr>
<tr><td class="h">36</td><td colspan="7"></td></tr><tr><td class="h">37</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">Readonly::Scalar my $PURPOSE_PATH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; q(WTSI Container Purpose Name);</td></tr>
<tr><td class="h">38</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">Readonly::Scalar my $SAMPLE_VOLUME_PATH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; q{Cherrypick Sample Volume};</td></tr>
<tr><td class="h">39</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">Readonly::Scalar my $BUFFER_VOLUME_PATH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; q{Cherrypick Buffer Volume};</td></tr>
<tr><td class="h">40</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">Readonly::Scalar my $FREEZER_PATH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; q{WTSI Freezer};</td></tr>
<tr><td class="h">41</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">Readonly::Scalar my $SHELF_PATH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; q{WTSI Shelf};</td></tr>
<tr><td class="h">42</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">Readonly::Scalar my $TRAY_PATH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; q{WTSI Tray};</td></tr>
<tr><td class="h">43</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">Readonly::Scalar my $RACK_PATH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; q{WTSI Rack};</td></tr>
<tr><td class="h">44</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">## use critic</td></tr>
<tr><td class="h">45</td><td colspan="7"></td></tr><tr><td class="h">46</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">Readonly::Scalar my $NUMBER_OF_COLUMNS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; 12;</td></tr>
<tr><td class="h">47</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">Readonly::Scalar my $NUMBER_OF_ROWS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; 8;</td></tr>
<tr><td class="h">48</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">Readonly::Scalar my $A_CHAR_CODE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; 64;</td></tr>
<tr><td class="h">49</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">Readonly::Scalar my $PLATE_NAME_START_INDEX&nbsp;&nbsp;&nbsp;=&gt; 3;</td></tr>
<tr><td class="h">50</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">Readonly::Scalar my $PLATE_NAME_START_LENGTH&nbsp;&nbsp;=&gt; 7;</td></tr>
<tr><td class="h">51</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">Readonly::Scalar my $EAN13_BARCODE_LENGTH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; 13;</td></tr>
<tr><td class="h">52</td><td colspan="7"></td></tr><tr><td class="h">53</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">Readonly::Scalar my $source_table_height&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; 100;</td></tr>
<tr><td class="h">54</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">Readonly::Scalar my $destination_table_height =&gt; 300;</td></tr>
<tr><td class="h">55</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">Readonly::Scalar my $buffer_table_height&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; 450;</td></tr>
<tr><td class="h">56</td><td colspan="7"></td></tr><tr><td class="h">57</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">has &#39;worksheet_filename&#39; =&gt; (</td></tr>
<tr><td class="h">58</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;isa =&gt; &#39;Str&#39;,</td></tr>
<tr><td class="h">59</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;is =&gt; &#39;ro&#39;,</td></tr>
<tr><td class="h">60</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;required =&gt; 1,</td></tr>
<tr><td class="h">61</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">);</td></tr>
<tr><td class="h">62</td><td colspan="7"></td></tr><tr><td class="h">63</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">has &#39;tecan_filename&#39; =&gt; (</td></tr>
<tr><td class="h">64</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;isa =&gt; &#39;Str&#39;,</td></tr>
<tr><td class="h">65</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;is =&gt; &#39;ro&#39;,</td></tr>
<tr><td class="h">66</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;required =&gt; 1,</td></tr>
<tr><td class="h">67</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">);</td></tr>
<tr><td class="h">68</td><td colspan="7"></td></tr><tr><td class="h">69</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">override &#39;run&#39; =&gt; sub {</td></tr>
<tr><td class="h">70</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;my $self = shift;</td></tr>
<tr><td class="h">71</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;super();</td></tr>
<tr><td class="h">72</td><td colspan="7"></td></tr><tr><td class="h">73</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;my $containers_data = $self-&gt;_get_containers_data();</td></tr>
<tr><td class="h">74</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;my $stamp = _get_stamp($containers_data, $self-&gt;request-&gt;user);</td></tr>
<tr><td class="h">75</td><td colspan="7"></td></tr><tr><td class="h">76</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# pdf generation</td></tr>
<tr><td class="h">77</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;my $pdf_data = _get_pdf_data($containers_data, $stamp);</td></tr>
<tr><td class="h">78</td><td colspan="7"></td></tr><tr><td class="h">79</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;$self-&gt;_create_worksheet_file($pdf_data)-&gt;saveas(q{./}.$self-&gt;worksheet_filename);</td></tr>
<tr><td class="h">80</td><td colspan="7"></td></tr><tr><td class="h">81</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# tecan file generation</td></tr>
<tr><td class="h">82</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;#&Acirc;&nbsp;temp way to only create the worksheet</td></tr>
<tr><td class="h">83</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;if ($self-&gt;tecan_filename) {</td></tr>
<tr><td class="h">84</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;_create_tecan_file($containers_data, $stamp, $self-&gt;tecan_filename);</td></tr>
<tr><td class="h">85</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">86</td><td colspan="7"></td></tr><tr><td class="h">87</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;return 1;</td></tr>
<tr><td class="h">88</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">};</td></tr>
<tr><td class="h">89</td><td colspan="7"></td></tr><tr><td class="h">90</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">################# date &amp; username ############</td></tr>
<tr><td class="h">91</td><td colspan="7"></td></tr><tr><td class="h">92</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _get_username {</td></tr>
<tr><td class="h">93</td><td><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-wtsi_clarity-epp-generic-worksheet_attacher-pm--subroutine.html#L93">1</a></div></td><td></td><td><div>1447</div></td><td class="s">&nbsp;&nbsp;my ($data, $realuser) = @_;</td></tr>
<tr><td class="h">94</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>2</div></td><td class="s">&nbsp;&nbsp;my $firstname = $data-&gt;{&#39;user_first_name&#39;};</td></tr>
<tr><td class="h">95</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>2</div></td><td class="s">&nbsp;&nbsp;my $lastname = $data-&gt;{&#39;user_last_name&#39;};</td></tr>
<tr><td class="h">96</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;return qq{$firstname $lastname (via $realuser)};</td></tr>
<tr><td class="h">97</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">98</td><td colspan="7"></td></tr><tr><td class="h">99</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _get_stamp {</td></tr>
<tr><td class="h">100</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="blib-lib-wtsi_clarity-epp-generic-worksheet_attacher-pm--subroutine.html#L100">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;my ($data, $realuser) = @_;</td></tr>
<tr><td class="h">101</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;my $username = _get_username($data, $realuser);</td></tr>
<tr><td class="h">102</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;my $date = DateTime-&gt;now-&gt;strftime(&#39;%A %d-%B-%Y at %H:%M:%S&#39;);</td></tr>
<tr><td class="h">103</td><td colspan="7"></td></tr><tr><td class="h">104</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;return qq{This file was created by $username on $date};</td></tr>
<tr><td class="h">105</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">106</td><td colspan="7"></td></tr><tr><td class="h">107</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">################# tecan file #################</td></tr>
<tr><td class="h">108</td><td colspan="7"></td></tr><tr><td class="h">109</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _create_tecan_file {</td></tr>
<tr><td class="h">110</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="blib-lib-wtsi_clarity-epp-generic-worksheet_attacher-pm--subroutine.html#L110">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;my ($self, $containers_data, $stamp, $full_filename) = @_;</td></tr>
<tr><td class="h">111</td><td colspan="7"></td></tr><tr><td class="h">112</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;my $file_content = $self-&gt;_get_TECAN_file_content($containers_data, $stamp);</td></tr>
<tr><td class="h">113</td><td colspan="7"></td></tr><tr><td class="h">114</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="blib-lib-wtsi_clarity-epp-generic-worksheet_attacher-pm--branch.html#L114">0</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;open my $fh, &#39;&gt;&#39;, $full_filename</td></tr>
<tr><td class="h">115</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;or croak qq{Could not create/open file &#39;$full_filename&#39;.};</td></tr>
<tr><td class="h">116</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;foreach my $line (@{$file_content})</td></tr>
<tr><td class="h">117</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;{</td></tr>
<tr><td class="h">118</td><td><div class="c0">0</div><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="blib-lib-wtsi_clarity-epp-generic-worksheet_attacher-pm--branch.html#L118">0</a></div></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;print {$fh} qq{$line\n} or croak qq[Failed to write to the file: $fh]; # Print each entry in our array to the file</td></tr>
<tr><td class="h">119</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">120</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="blib-lib-wtsi_clarity-epp-generic-worksheet_attacher-pm--branch.html#L120">0</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;close $fh</td></tr>
<tr><td class="h">121</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;or croak qq{ Unable to close $full_filename.};</td></tr>
<tr><td class="h">122</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;return $full_filename;</td></tr>
<tr><td class="h">123</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">124</td><td colspan="7"></td></tr><tr><td class="h">125</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _get_TECAN_file_content {</td></tr>
<tr><td class="h">126</td><td><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-wtsi_clarity-epp-generic-worksheet_attacher-pm--subroutine.html#L126">1</a></div></td><td></td><td><div>2123</div></td><td class="s">&nbsp;&nbsp;my ($self, $containers_data, $stamp) = @_;</td></tr>
<tr><td class="h">127</td><td colspan="7"></td></tr><tr><td class="h">128</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>2</div></td><td class="s">&nbsp;&nbsp;my @content_output = ();</td></tr>
<tr><td class="h">129</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>1</div></td><td class="s">&nbsp;&nbsp;my @buffer_output = ();</td></tr>
<tr><td class="h">130</td><td colspan="7"></td></tr><tr><td class="h">131</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# creating the comments at the top of the file</td></tr>
<tr><td class="h">132</td><td colspan="7"></td></tr><tr><td class="h">133</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>2</div></td><td class="s">&nbsp;&nbsp;push @content_output, &#39;C;&#39;;</td></tr>
<tr><td class="h">134</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>2</div></td><td class="s">&nbsp;&nbsp;push @content_output, &#39;C; &#39;.$stamp;</td></tr>
<tr><td class="h">135</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>1</div></td><td class="s">&nbsp;&nbsp;push @content_output, &#39;C;&#39;;</td></tr>
<tr><td class="h">136</td><td colspan="7"></td></tr><tr><td class="h">137</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# creating main content</td></tr>
<tr><td class="h">138</td><td colspan="7"></td></tr><tr><td class="h">139</td><td><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>1</div><div>5</div></td><td class="s">&nbsp;&nbsp;foreach my $uri (sort keys %{$containers_data-&gt;{&#39;output_container_info&#39;}}) {</td></tr>
<tr><td class="h">140</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($samples, $buffers) = $self-&gt;_get_TECAN_file_content_per_URI($containers_data, $uri);</td></tr>
<tr><td class="h">141</td><td><div class="c3">2</div><div class="c3">2</div></td><td></td><td></td><td></td><td></td><td><div>2</div><div>2</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;push @content_output, @{$samples};</td></tr>
<tr><td class="h">142</td><td><div class="c3">2</div><div class="c3">2</div></td><td></td><td></td><td></td><td></td><td><div>3</div><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;push @buffer_output, @{$buffers};</td></tr>
<tr><td class="h">143</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">144</td><td colspan="7"></td></tr><tr><td class="h">145</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>2</div></td><td class="s">&nbsp;&nbsp;push @content_output, @buffer_output;</td></tr>
<tr><td class="h">146</td><td colspan="7"></td></tr><tr><td class="h">147</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# creating the comments in the end of the file</td></tr>
<tr><td class="h">148</td><td colspan="7"></td></tr><tr><td class="h">149</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>1</div></td><td class="s">&nbsp;&nbsp;push @content_output, &#39;C;&#39;;</td></tr>
<tr><td class="h">150</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>1</div></td><td class="s">&nbsp;&nbsp;my $n = 1;</td></tr>
<tr><td class="h">151</td><td><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>1</div><div>3</div></td><td class="s">&nbsp;&nbsp;foreach my $input (sort keys %{$containers_data-&gt;{&#39;input_container_info&#39;}}) {</td></tr>
<tr><td class="h">152</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td></td><td><div>2</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $barcode = $containers_data-&gt;{&#39;input_container_info&#39;}-&gt;{$input}-&gt;{&#39;barcode&#39;};</td></tr>
<tr><td class="h">153</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;push @content_output, qq{C; SRC$n = $barcode};</td></tr>
<tr><td class="h">154</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$n++;</td></tr>
<tr><td class="h">155</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">156</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>2</div></td><td class="s">&nbsp;&nbsp;push @content_output, &#39;C;&#39;;</td></tr>
<tr><td class="h">157</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>1</div></td><td class="s">&nbsp;&nbsp;$n = 1;</td></tr>
<tr><td class="h">158</td><td><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>1</div><div>2</div></td><td class="s">&nbsp;&nbsp;foreach my $output (sort keys %{$containers_data-&gt;{&#39;output_container_info&#39;}}) {</td></tr>
<tr><td class="h">159</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $barcode = $containers_data-&gt;{&#39;output_container_info&#39;}-&gt;{$output}-&gt;{&#39;barcode&#39;};</td></tr>
<tr><td class="h">160</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td></td><td><div>2</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;push @content_output, qq{C; DEST$n = $barcode};</td></tr>
<tr><td class="h">161</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td></td><td><div>2</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$n++;</td></tr>
<tr><td class="h">162</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">163</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;push @content_output, &#39;C;&#39;;</td></tr>
<tr><td class="h">164</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>2</div></td><td class="s">&nbsp;&nbsp;return \@content_output;</td></tr>
<tr><td class="h">165</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">166</td><td colspan="7"></td></tr><tr><td class="h">167</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _get_well_position {</td></tr>
<tr><td class="h">168</td><td><div class="c3">62</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-wtsi_clarity-epp-generic-worksheet_attacher-pm--subroutine.html#L168">62</a></div></td><td></td><td><div>50</div></td><td class="s">&nbsp;&nbsp;my ($self, $well_position) = @_;</td></tr>
<tr><td class="h">169</td><td><div class="c3">62</div></td><td></td><td></td><td></td><td></td><td><div>109</div></td><td class="s">&nbsp;&nbsp;return wtsi_clarity::util::well_mapper-&gt;well_location_index($well_position, $NUMBER_OF_ROWS, $NUMBER_OF_COLUMNS);</td></tr>
<tr><td class="h">170</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">171</td><td colspan="7"></td></tr><tr><td class="h">172</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _is_integer {</td></tr>
<tr><td class="h">173</td><td><div class="c3">70</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-wtsi_clarity-epp-generic-worksheet_attacher-pm--subroutine.html#L173">70</a></div></td><td></td><td><div>9076</div></td><td class="s">&nbsp;&nbsp;my $x = shift;</td></tr>
<tr><td class="h">174</td><td><div class="c3">70</div></td><td><div class="c3" title="T/F"><a href="blib-lib-wtsi_clarity-epp-generic-worksheet_attacher-pm--branch.html#L174">100</a></div></td><td></td><td></td><td></td><td><div>193</div></td><td class="s">&nbsp;&nbsp;return ($x =~ /^-?\d+\z/sxm) ? 1 : 0;</td></tr>
<tr><td class="h">175</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">176</td><td colspan="7"></td></tr><tr><td class="h">177</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _get_TECAN_file_content_per_URI {</td></tr>
<tr><td class="h">178</td><td><div class="c3">6</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-wtsi_clarity-epp-generic-worksheet_attacher-pm--subroutine.html#L178">6</a></div></td><td></td><td><div>7394</div></td><td class="s">&nbsp;&nbsp;my ($self, $data, $uri) = @_;</td></tr>
<tr><td class="h">179</td><td><div class="c3">6</div></td><td></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;my @sample_output = ();</td></tr>
<tr><td class="h">180</td><td><div class="c3">6</div></td><td></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;my @buffer_output = ();</td></tr>
<tr><td class="h">181</td><td><div class="c3">6</div></td><td></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;my $output_container = $data-&gt;{&#39;output_container_info&#39;}-&gt;{$uri};</td></tr>
<tr><td class="h">182</td><td><div class="c3">6</div></td><td></td><td></td><td></td><td></td><td><div>11</div></td><td class="s">&nbsp;&nbsp;my $output_type = $data-&gt;{&#39;output_container_info&#39;}-&gt;{$uri}-&gt;{&#39;type&#39;};</td></tr>
<tr><td class="h">183</td><td><div class="c3">6</div></td><td></td><td></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;my $output_barcode = $data-&gt;{&#39;output_container_info&#39;}-&gt;{$uri}-&gt;{&#39;barcode&#39;};</td></tr>
<tr><td class="h">184</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# keys are sorted to facilitate testing!</td></tr>
<tr><td class="h">185</td><td><div class="c3">6</div><div class="c3">6</div></td><td></td><td></td><td></td><td></td><td><div>6</div><div>25</div></td><td class="s">&nbsp;&nbsp;foreach my $out_loc (sort keys %{$output_container-&gt;{&#39;container_details&#39;}}) {</td></tr>
<tr><td class="h">186</td><td><div class="c3">34</div></td><td></td><td></td><td></td><td></td><td><div>33</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $in_details = $output_container-&gt;{&#39;container_details&#39;}-&gt;{$out_loc};</td></tr>
<tr><td class="h">187</td><td><div class="c3">34</div><div class="c3">34</div></td><td><div class="c3" title="T/F"><a href="blib-lib-wtsi_clarity-epp-generic-worksheet_attacher-pm--branch.html#L187">100</a></div></td><td></td><td></td><td></td><td><div>20</div><div>58</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if (scalar keys %{$in_details}) {</td></tr>
<tr><td class="h">188</td><td><div class="c3">33</div></td><td></td><td></td><td></td><td></td><td><div>41</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $out_loc_dec = $self-&gt;_get_well_position($out_loc);</td></tr>
<tr><td class="h">189</td><td colspan="7"></td></tr><tr><td class="h">190</td><td><div class="c3">33</div></td><td><div class="c3" title="T/F"><a href="blib-lib-wtsi_clarity-epp-generic-worksheet_attacher-pm--branch.html#L190">100</a></div></td><td></td><td></td><td></td><td><div>136</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (!_is_integer($out_loc_dec)) {</td></tr>
<tr><td class="h">191</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>14</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;croak &quot;Output location is not an integer: &quot; . $out_loc_dec;</td></tr>
<tr><td class="h">192</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">193</td><td colspan="7"></td></tr><tr><td class="h">194</td><td><div class="c3">32</div></td><td></td><td></td><td></td><td></td><td><div>44</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $inp_loc_dec = $self-&gt;_get_well_position($in_details-&gt;{&#39;input_location&#39;});</td></tr>
<tr><td class="h">195</td><td colspan="7"></td></tr><tr><td class="h">196</td><td><div class="c3">32</div></td><td><div class="c3" title="T/F"><a href="blib-lib-wtsi_clarity-epp-generic-worksheet_attacher-pm--branch.html#L196">100</a></div></td><td></td><td></td><td></td><td><div>58</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (!_is_integer($inp_loc_dec)) {</td></tr>
<tr><td class="h">197</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>9</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;croak &quot;Input location is not an integer: &quot; . $inp_loc_dec;</td></tr>
<tr><td class="h">198</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">199</td><td colspan="7"></td></tr><tr><td class="h">200</td><td><div class="c3">31</div></td><td></td><td></td><td></td><td></td><td><div>135</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $sample_volume = $in_details-&gt;{&#39;sample_volume&#39;};</td></tr>
<tr><td class="h">201</td><td><div class="c3">31</div></td><td></td><td></td><td></td><td></td><td><div>26</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $buffer_volume = $in_details-&gt;{&#39;buffer_volume&#39;};</td></tr>
<tr><td class="h">202</td><td><div class="c3">31</div></td><td></td><td></td><td></td><td></td><td><div>23</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $input_uri = $in_details-&gt;{&#39;input_uri&#39;};</td></tr>
<tr><td class="h">203</td><td><div class="c3">31</div></td><td></td><td></td><td></td><td></td><td><div>29</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $input_type = $data-&gt;{&#39;input_container_info&#39;}-&gt;{$input_uri}-&gt;{&#39;type&#39;};</td></tr>
<tr><td class="h">204</td><td><div class="c3">31</div></td><td></td><td></td><td></td><td></td><td><div>29</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $input_barcode = $data-&gt;{&#39;input_container_info&#39;}-&gt;{$input_uri}-&gt;{&#39;barcode&#39;};</td></tr>
<tr><td class="h">205</td><td colspan="7"></td></tr><tr><td class="h">206</td><td><div class="c3">31</div></td><td></td><td></td><td></td><td></td><td><div>38</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $input_sample_string = qq{A;$input_barcode;;$input_type;$inp_loc_dec;;$sample_volume};</td></tr>
<tr><td class="h">207</td><td><div class="c3">31</div></td><td></td><td></td><td></td><td></td><td><div>31</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $output_sample_string = qq{D;$output_barcode;;$output_type;$out_loc_dec;;$sample_volume};</td></tr>
<tr><td class="h">208</td><td><div class="c3">31</div></td><td></td><td></td><td></td><td></td><td><div>16</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $w_string = q{W;};</td></tr>
<tr><td class="h">209</td><td colspan="7"></td></tr><tr><td class="h">210</td><td><div class="c3">31</div></td><td></td><td></td><td></td><td></td><td><div>79</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push @sample_output, {</td></tr>
<tr><td class="h">211</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output_location =&gt; $out_loc_dec,</td></tr>
<tr><td class="h">212</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; join &quot;\n&quot;, $input_sample_string, $output_sample_string, $w_string,</td></tr>
<tr><td class="h">213</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};</td></tr>
<tr><td class="h">214</td><td colspan="7"></td></tr><tr><td class="h">215</td><td><div class="c3">31</div></td><td><div class="c3" title="T/F"><a href="blib-lib-wtsi_clarity-epp-generic-worksheet_attacher-pm--branch.html#L215">100</a></div></td><td></td><td></td><td></td><td><div>53</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($buffer_volume != 0) {</td></tr>
<tr><td class="h">216</td><td><div class="c3">11</div></td><td></td><td></td><td></td><td></td><td><div>13</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $input_buffer_string = qq{A;BUFF;;96-TROUGH;$inp_loc_dec;;$buffer_volume};</td></tr>
<tr><td class="h">217</td><td><div class="c3">11</div></td><td></td><td></td><td></td><td></td><td><div>14</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $output_buffer_string = qq{D;$output_barcode;;$output_type;$out_loc_dec;;$buffer_volume};</td></tr>
<tr><td class="h">218</td><td colspan="7"></td></tr><tr><td class="h">219</td><td><div class="c3">11</div></td><td></td><td></td><td></td><td></td><td><div>39</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push @buffer_output, {</td></tr>
<tr><td class="h">220</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output_location =&gt; $out_loc_dec,</td></tr>
<tr><td class="h">221</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output =&gt; join &quot;\n&quot;, $input_buffer_string, $output_buffer_string, $w_string,</td></tr>
<tr><td class="h">222</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};</td></tr>
<tr><td class="h">223</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">224</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">225</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">226</td><td colspan="7"></td></tr><tr><td class="h">227</td><td><div class="c3">31</div></td><td></td><td></td><td></td><td></td><td><div>43</div></td><td class="s">&nbsp;&nbsp;@sample_output = map {</td></tr>
<tr><td class="h">228</td><td><div class="c3">88</div></td><td></td><td></td><td></td><td></td><td><div>58</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$_-&gt;{&#39;output&#39;}</td></tr>
<tr><td class="h">229</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;} sort {</td></tr>
<tr><td class="h">230</td><td><div class="c3">4</div></td><td></td><td></td><td></td><td></td><td><div>13</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$a-&gt;{&#39;output_location&#39;} &lt;=&gt; $b-&gt;{&#39;output_location&#39;}</td></tr>
<tr><td class="h">231</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;} @sample_output;</td></tr>
<tr><td class="h">232</td><td colspan="7"></td></tr><tr><td class="h">233</td><td><div class="c3">11</div></td><td></td><td></td><td></td><td></td><td><div>18</div></td><td class="s">&nbsp;&nbsp;@buffer_output = map {</td></tr>
<tr><td class="h">234</td><td><div class="c3">19</div></td><td></td><td></td><td></td><td></td><td><div>18</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$_-&gt;{&#39;output&#39;}</td></tr>
<tr><td class="h">235</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;} sort {</td></tr>
<tr><td class="h">236</td><td><div class="c3">4</div></td><td></td><td></td><td></td><td></td><td><div>8</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$a-&gt;{&#39;output_location&#39;} &lt;=&gt; $b-&gt;{&#39;output_location&#39;}</td></tr>
<tr><td class="h">237</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;} @buffer_output;</td></tr>
<tr><td class="h">238</td><td colspan="7"></td></tr><tr><td class="h">239</td><td><div class="c3">4</div></td><td></td><td></td><td></td><td></td><td><div>12</div></td><td class="s">&nbsp;&nbsp;return (\@sample_output, \@buffer_output);</td></tr>
<tr><td class="h">240</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">241</td><td colspan="7"></td></tr><tr><td class="h">242</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">################# worksheet #################</td></tr>
<tr><td class="h">243</td><td colspan="7"></td></tr><tr><td class="h">244</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _create_worksheet_file {</td></tr>
<tr><td class="h">245</td><td><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-wtsi_clarity-epp-generic-worksheet_attacher-pm--subroutine.html#L245">1</a></div></td><td></td><td><div>3698</div></td><td class="s">&nbsp;&nbsp;my ($self, $pdf_data) = @_;</td></tr>
<tr><td class="h">246</td><td colspan="7"></td></tr><tr><td class="h">247</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>15</div></td><td class="s">&nbsp;&nbsp;my $pdf_generator = wtsi_clarity::util::pdf::pdf_generator-&gt;new(stamp =&gt; $pdf_data-&gt;{&#39;stamp&#39;});</td></tr>
<tr><td class="h">248</td><td colspan="7"></td></tr><tr><td class="h">249</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# for each output container, we produce a new page...</td></tr>
<tr><td class="h">250</td><td><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>1188</div><div>3</div></td><td class="s">&nbsp;&nbsp;foreach my $page_data (@{$pdf_data-&gt;{&#39;pages&#39;}}) {</td></tr>
<tr><td class="h">251</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $page = $self-&gt;pdf-&gt;page();</td></tr>
<tr><td class="h">252</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$page-&gt;mediabox(&#39;A4&#39;);</td></tr>
<tr><td class="h">253</td><td colspan="7"></td></tr><tr><td class="h">254</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$pdf_generator-&gt;add_title_to_page($page, $page_data-&gt;{&#39;title&#39;});</td></tr>
<tr><td class="h">255</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$pdf_generator-&gt;add_timestamp($page);</td></tr>
<tr><td class="h">256</td><td colspan="7"></td></tr><tr><td class="h">257</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$pdf_generator-&gt;add_io_block_to_page($self-&gt;pdf, $page, $page_data-&gt;{&#39;input_table&#39;}, $page_data-&gt;{&#39;input_table_title&#39;}, $source_table_height);</td></tr>
<tr><td class="h">258</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$pdf_generator-&gt;add_io_block_to_page($self-&gt;pdf, $page, $page_data-&gt;{&#39;output_table&#39;}, $page_data-&gt;{&#39;output_table_title&#39;}, $destination_table_height);</td></tr>
<tr><td class="h">259</td><td colspan="7"></td></tr><tr><td class="h">260</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$pdf_generator-&gt;add_buffer_block_to_page($self-&gt;pdf, $page, $page_data-&gt;{&#39;plate_table&#39;}, $page_data-&gt;{&#39;plate_table_title&#39;}, $page_data-&gt;{&#39;plate_table_cell_styles&#39;}, $buffer_table_height);</td></tr>
<tr><td class="h">261</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">262</td><td colspan="7"></td></tr><tr><td class="h">263</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>32</div></td><td class="s">&nbsp;&nbsp;return $self-&gt;pdf;</td></tr>
<tr><td class="h">264</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">265</td><td colspan="7"></td></tr><tr><td class="h">266</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _get_pdf_data {</td></tr>
<tr><td class="h">267</td><td><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-wtsi_clarity-epp-generic-worksheet_attacher-pm--subroutine.html#L267">1</a></div></td><td></td><td><div>269</div></td><td class="s">&nbsp;&nbsp;my ($containers_data, $stamp) = @_;</td></tr>
<tr><td class="h">268</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>1</div></td><td class="s">&nbsp;&nbsp;my $pdf_data = {};</td></tr>
<tr><td class="h">269</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>2</div></td><td class="s">&nbsp;&nbsp;$pdf_data-&gt;{&#39;stamp&#39;} = $stamp;</td></tr>
<tr><td class="h">270</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>2</div></td><td class="s">&nbsp;&nbsp;$pdf_data-&gt;{&#39;pages&#39;} = [];</td></tr>
<tr><td class="h">271</td><td colspan="7"></td></tr><tr><td class="h">272</td><td><div class="c3">1</div><div class="c3">3</div></td><td></td><td></td><td></td><td></td><td><div>1</div><div>8</div></td><td class="s">&nbsp;&nbsp;while (my ($uri, $data) = each %{$containers_data-&gt;{&#39;output_container_info&#39;}} ) {</td></tr>
<tr><td class="h">273</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td></td><td><div>2</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $page = {};</td></tr>
<tr><td class="h">274</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$page-&gt;{&#39;title&#39;} = _get_title($containers_data, $uri);</td></tr>
<tr><td class="h">275</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$page-&gt;{&#39;input_table_title&#39;} = q{Source plates};</td></tr>
<tr><td class="h">276</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td></td><td><div>2</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$page-&gt;{&#39;input_table&#39;} = _get_source_plate_data($containers_data, $uri);</td></tr>
<tr><td class="h">277</td><td colspan="7"></td></tr><tr><td class="h">278</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td></td><td><div>2</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$page-&gt;{&#39;output_table_title&#39;} = q{Destination plates};</td></tr>
<tr><td class="h">279</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$page-&gt;{&#39;output_table&#39;} = _get_destination_plate_data($containers_data, $uri);</td></tr>
<tr><td class="h">280</td><td colspan="7"></td></tr><tr><td class="h">281</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($table_data, $table_properties) = _get_table_data($data-&gt;{&#39;container_details&#39;});</td></tr>
<tr><td class="h">282</td><td colspan="7"></td></tr><tr><td class="h">283</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$page-&gt;{&#39;plate_table_title&#39;} = q{Required buffer};</td></tr>
<tr><td class="h">284</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td></td><td><div>2</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$page-&gt;{&#39;plate_table&#39;} = $table_data;</td></tr>
<tr><td class="h">285</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$page-&gt;{&#39;plate_table_cell_styles&#39;} = $table_properties;</td></tr>
<tr><td class="h">286</td><td colspan="7"></td></tr><tr><td class="h">287</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;push $pdf_data-&gt;{&#39;pages&#39;}, $page;</td></tr>
<tr><td class="h">288</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">289</td><td colspan="7"></td></tr><tr><td class="h">290</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;return $pdf_data;</td></tr>
<tr><td class="h">291</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">292</td><td colspan="7"></td></tr><tr><td class="h">293</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _get_title {</td></tr>
<tr><td class="h">294</td><td><div class="c3">3</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-wtsi_clarity-epp-generic-worksheet_attacher-pm--subroutine.html#L294">3</a></div></td><td></td><td><div>552</div></td><td class="s">&nbsp;&nbsp;my ($data, $out_uri) = @_;</td></tr>
<tr><td class="h">295</td><td colspan="7"></td></tr><tr><td class="h">296</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;my $out_purpose = $data-&gt;{ q{output_container_info} }-&gt;{$out_uri}-&gt;{ q{purpose} };</td></tr>
<tr><td class="h">297</td><td colspan="7"></td></tr><tr><td class="h">298</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# we get all the wells concerned by this output.</td></tr>
<tr><td class="h">299</td><td><div class="c3">3</div><div class="c3">3</div></td><td></td><td></td><td></td><td></td><td><div>2</div><div>15</div></td><td class="s">&nbsp;&nbsp;my $wells = Mojo::Collection-&gt;new( values %{$data-&gt;{ q{output_container_info} }-&gt;{$out_uri}-&gt;{ q{container_details} }} );</td></tr>
<tr><td class="h">300</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# we assume that all input plate have the same purpose !!</td></tr>
<tr><td class="h">301</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;my $an_input_id = $wells-&gt;grep ( sub {</td></tr>
<tr><td class="h">302</td><td><div class="c3">13</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-wtsi_clarity-epp-generic-worksheet_attacher-pm--subroutine.html#L302">13</a></div></td><td></td><td><div>38</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return defined $_-&gt;{&#39;input_id&#39;};</td></tr>
<tr><td class="h">303</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;} ) # we filter on the presence of an input_id</td></tr>
<tr><td class="h">304</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;-&gt;map&nbsp;&nbsp;( sub {</td></tr>
<tr><td class="h">305</td><td><div class="c3">11</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-wtsi_clarity-epp-generic-worksheet_attacher-pm--subroutine.html#L305">11</a></div></td><td></td><td><div>37</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$_-&gt;{&#39;input_id&#39;};</td></tr>
<tr><td class="h">306</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;} ) # we pluck the input_ids</td></tr>
<tr><td class="h">307</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td></td><td><div>33</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;-&gt;first;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# we only take the first one</td></tr>
<tr><td class="h">308</td><td colspan="7"></td></tr><tr><td class="h">309</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td></td><td><div>28</div></td><td class="s">&nbsp;&nbsp;my $in_purpose = $data-&gt;{ q{input_container_info} }-&gt;{$an_input_id}-&gt;{ q{purpose} };</td></tr>
<tr><td class="h">310</td><td colspan="7"></td></tr><tr><td class="h">311</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;my $process = $data-&gt;{ q{process_id} };</td></tr>
<tr><td class="h">312</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td></td><td><div>9</div></td><td class="s">&nbsp;&nbsp;return qq{Process $process - $in_purpose -&gt; $out_purpose};</td></tr>
<tr><td class="h">313</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">314</td><td colspan="7"></td></tr><tr><td class="h">315</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _get_source_plate_data {</td></tr>
<tr><td class="h">316</td><td><div class="c3">3</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-wtsi_clarity-epp-generic-worksheet_attacher-pm--subroutine.html#L316">3</a></div></td><td></td><td><div>335</div></td><td class="s">&nbsp;&nbsp;my ($data, $uri) = @_;</td></tr>
<tr><td class="h">317</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;my $input_plates = {};</td></tr>
<tr><td class="h">318</td><td colspan="7"></td></tr><tr><td class="h">319</td><td><div class="c3">3</div><div class="c3">16</div></td><td></td><td></td><td></td><td></td><td><div>3</div><div>27</div></td><td class="s">&nbsp;&nbsp;while (my ($pos, $info) = each %{$data-&gt;{&#39;output_container_info&#39;}</td></tr>
<tr><td class="h">320</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;-&gt;{$uri}</td></tr>
<tr><td class="h">321</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;-&gt;{&#39;container_details&#39;}&nbsp;&nbsp;&nbsp;&nbsp;} ) {</td></tr>
<tr><td class="h">322</td><td><div class="c3">13</div></td><td><div class="c3" title="T/F"><a href="blib-lib-wtsi_clarity-epp-generic-worksheet_attacher-pm--branch.html#L322">100</a></div></td><td></td><td></td><td></td><td><div>15</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if (defined $info-&gt;{&#39;input_uri&#39;}) {</td></tr>
<tr><td class="h">323</td><td><div class="c3">11</div></td><td></td><td></td><td></td><td></td><td><div>10</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$input_plates-&gt;{$info-&gt;{&#39;input_uri&#39;}} = 1;</td></tr>
<tr><td class="h">324</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">325</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">326</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;my @table_data = ();</td></tr>
<tr><td class="h">327</td><td colspan="7"></td></tr><tr><td class="h">328</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;push @table_data, [&#39;Plate name&#39;, &#39;Barcode&#39;, &#39;Freezer&#39;, &#39;Shelf&#39;, &#39;Rack&#39;, &#39;Tray&#39;];</td></tr>
<tr><td class="h">329</td><td colspan="7"></td></tr><tr><td class="h">330</td><td><div class="c3">3</div><div class="c3">3</div></td><td></td><td></td><td></td><td></td><td><div>2</div><div>8</div></td><td class="s">&nbsp;&nbsp;foreach my $key (sort keys %{$input_plates}) {</td></tr>
<tr><td class="h">331</td><td><div class="c3">5</div></td><td></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $plate_name = $data-&gt;{&#39;input_container_info&#39;}-&gt;{$key}-&gt;{&#39;plate_name&#39;};</td></tr>
<tr><td class="h">332</td><td><div class="c3">5</div></td><td></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $barcode = $data-&gt;{&#39;input_container_info&#39;}-&gt;{$key}-&gt;{&#39;barcode&#39;};</td></tr>
<tr><td class="h">333</td><td><div class="c3">5</div></td><td></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $freezer = $data-&gt;{&#39;input_container_info&#39;}-&gt;{$key}-&gt;{&#39;freezer&#39;};</td></tr>
<tr><td class="h">334</td><td><div class="c3">5</div></td><td></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $shelf = $data-&gt;{&#39;input_container_info&#39;}-&gt;{$key}-&gt;{&#39;shelf&#39;};</td></tr>
<tr><td class="h">335</td><td><div class="c3">5</div></td><td></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $rack = $data-&gt;{&#39;input_container_info&#39;}-&gt;{$key}-&gt;{&#39;rack&#39;};</td></tr>
<tr><td class="h">336</td><td><div class="c3">5</div></td><td></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $tray = $data-&gt;{&#39;input_container_info&#39;}-&gt;{$key}-&gt;{&#39;tray&#39;};</td></tr>
<tr><td class="h">337</td><td><div class="c3">5</div></td><td></td><td></td><td></td><td></td><td><div>9</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;push @table_data, [$plate_name, $barcode, $freezer, $shelf, $rack, $tray];</td></tr>
<tr><td class="h">338</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">339</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;return \@table_data;</td></tr>
<tr><td class="h">340</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">341</td><td colspan="7"></td></tr><tr><td class="h">342</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _get_destination_plate_data {</td></tr>
<tr><td class="h">343</td><td><div class="c3">3</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-wtsi_clarity-epp-generic-worksheet_attacher-pm--subroutine.html#L343">3</a></div></td><td></td><td><div>4703</div></td><td class="s">&nbsp;&nbsp;my ($data, $uri) = @_;</td></tr>
<tr><td class="h">344</td><td colspan="7"></td></tr><tr><td class="h">345</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;my @table_data = ();</td></tr>
<tr><td class="h">346</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;push @table_data, [&#39;Plate name&#39;, &#39;Barcode&#39;, &#39;Wells&#39;];</td></tr>
<tr><td class="h">347</td><td colspan="7"></td></tr><tr><td class="h">348</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;my $plate_name = $data-&gt;{&#39;output_container_info&#39;}-&gt;{$uri}-&gt;{&#39;plate_name&#39;};</td></tr>
<tr><td class="h">349</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;my $barcode = $data-&gt;{&#39;output_container_info&#39;}-&gt;{$uri}-&gt;{&#39;barcode&#39;};</td></tr>
<tr><td class="h">350</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;my $wells = $data-&gt;{&#39;output_container_info&#39;}-&gt;{$uri}-&gt;{&#39;occ_wells&#39;};</td></tr>
<tr><td class="h">351</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;push @table_data, [$plate_name, $barcode, $wells];</td></tr>
<tr><td class="h">352</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;return \@table_data;</td></tr>
<tr><td class="h">353</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">354</td><td colspan="7"></td></tr><tr><td class="h">355</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _get_table_data {</td></tr>
<tr><td class="h">356</td><td><div class="c3">3</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-wtsi_clarity-epp-generic-worksheet_attacher-pm--subroutine.html#L356">3</a></div></td><td></td><td><div>145</div></td><td class="s">&nbsp;&nbsp;my ($data) = @_;</td></tr>
<tr><td class="h">357</td><td colspan="7"></td></tr><tr><td class="h">358</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;my @table_data = ();</td></tr>
<tr><td class="h">359</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td></td><td><div>2</div></td><td class="s">&nbsp;&nbsp;my @table_properties = ();</td></tr>
<tr><td class="h">360</td><td colspan="7"></td></tr><tr><td class="h">361</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;my $colour_indexes = _get_colour_indexes($data);</td></tr>
<tr><td class="h">362</td><td colspan="7"></td></tr><tr><td class="h">363</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;foreach my $j (0..$NUMBER_OF_ROWS + 1) {</td></tr>
<tr><td class="h">364</td><td><div class="c3">30</div></td><td></td><td></td><td></td><td></td><td><div>21</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @row = ();</td></tr>
<tr><td class="h">365</td><td><div class="c3">30</div></td><td></td><td></td><td></td><td></td><td><div>14</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @row_properties = ();</td></tr>
<tr><td class="h">366</td><td><div class="c3">30</div></td><td></td><td></td><td></td><td></td><td><div>29</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;foreach my $i (0..$NUMBER_OF_COLUMNS + 1) {</td></tr>
<tr><td class="h">367</td><td><div class="c3">420</div></td><td></td><td></td><td></td><td></td><td><div>311</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ($content, $properties) = _get_cell($data, $colour_indexes, $i, $j);</td></tr>
<tr><td class="h">368</td><td><div class="c3">420</div></td><td></td><td></td><td></td><td></td><td><div>338</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push @row, $content;</td></tr>
<tr><td class="h">369</td><td><div class="c3">420</div></td><td></td><td></td><td></td><td></td><td><div>335</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push @row_properties, $properties;</td></tr>
<tr><td class="h">370</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">371</td><td><div class="c3">30</div></td><td></td><td></td><td></td><td></td><td><div>25</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;push @table_data, \@row;</td></tr>
<tr><td class="h">372</td><td><div class="c3">30</div></td><td></td><td></td><td></td><td></td><td><div>43</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;push @table_properties, \@row_properties;</td></tr>
<tr><td class="h">373</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">374</td><td colspan="7"></td></tr><tr><td class="h">375</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td></td><td><div>9</div></td><td class="s">&nbsp;&nbsp;return (\@table_data, \@table_properties);</td></tr>
<tr><td class="h">376</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">377</td><td colspan="7"></td></tr><tr><td class="h">378</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _get_cell {</td></tr>
<tr><td class="h">379</td><td><div class="c3">420</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-wtsi_clarity-epp-generic-worksheet_attacher-pm--subroutine.html#L379">420</a></div></td><td></td><td><div>287</div></td><td class="s">&nbsp;&nbsp;my ($data, $colour_indexes, $i, $j) = @_;</td></tr>
<tr><td class="h">380</td><td colspan="7"></td></tr><tr><td class="h">381</td><td><div class="c3">420</div></td><td></td><td></td><td></td><td></td><td><div>188</div></td><td class="s">&nbsp;&nbsp;my $content;</td></tr>
<tr><td class="h">382</td><td><div class="c3">420</div></td><td></td><td></td><td></td><td></td><td><div>179</div></td><td class="s">&nbsp;&nbsp;my $properties;</td></tr>
<tr><td class="h">383</td><td colspan="7"></td></tr><tr><td class="h">384</td><td><div class="c3">420</div></td><td><div class="c3" title="T/F"><a href="blib-lib-wtsi_clarity-epp-generic-worksheet_attacher-pm--branch.html#L384">100</a></div></td><td></td><td></td><td></td><td><div>280</div></td><td class="s">&nbsp;&nbsp;if (my $pos = _get_location($i, $j)) {</td></tr>
<tr><td class="h">385</td><td><div class="c3">288</div></td><td></td><td></td><td></td><td></td><td><div>189</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$content = _get_cell_content($data, $pos);</td></tr>
<tr><td class="h">386</td><td><div class="c3">288</div></td><td></td><td></td><td></td><td></td><td><div>219</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$properties = _get_cell_properties($data, $colour_indexes, $pos);</td></tr>
<tr><td class="h">387</td><td colspan="7"></td></tr><tr><td class="h">388</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">389</td><td><div class="c3">132</div></td><td></td><td></td><td></td><td></td><td><div>95</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$content = _get_legend_content($i, $j);</td></tr>
<tr><td class="h">390</td><td><div class="c3">132</div></td><td></td><td></td><td></td><td></td><td><div>102</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$properties = _get_legend_properties();</td></tr>
<tr><td class="h">391</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">392</td><td><div class="c3">420</div></td><td></td><td></td><td></td><td></td><td><div>484</div></td><td class="s">&nbsp;&nbsp;return ($content, $properties);</td></tr>
<tr><td class="h">393</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">394</td><td colspan="7"></td></tr><tr><td class="h">395</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _get_cell_content {</td></tr>
<tr><td class="h">396</td><td><div class="c3">288</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-wtsi_clarity-epp-generic-worksheet_attacher-pm--subroutine.html#L396">288</a></div></td><td></td><td><div>188</div></td><td class="s">&nbsp;&nbsp;my ($data, $pos) = @_;</td></tr>
<tr><td class="h">397</td><td><div class="c3">288</div></td><td></td><td></td><td></td><td></td><td><div>200</div></td><td class="s">&nbsp;&nbsp;my $cell = $data-&gt;{$pos};</td></tr>
<tr><td class="h">398</td><td><div class="c3">288</div><div class="c3">33</div></td><td><div class="c3" title="T/F"><a href="blib-lib-wtsi_clarity-epp-generic-worksheet_attacher-pm--branch.html#L398">100</a></div></td><td><div class="c3"><a href="blib-lib-wtsi_clarity-epp-generic-worksheet_attacher-pm--condition.html#L398">100</a></div></td><td></td><td></td><td><div>322</div><div>47</div></td><td class="s">&nbsp;&nbsp;if ($cell and %{$cell}) {</td></tr>
<tr><td class="h">399</td><td><div class="c3">32</div></td><td></td><td></td><td></td><td></td><td><div>24</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $container_id = $cell-&gt;{&#39;input_id&#39;};</td></tr>
<tr><td class="h">400</td><td><div class="c3">32</div></td><td></td><td></td><td></td><td></td><td><div>40</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$container_id =~ s/\-//xms;</td></tr>
<tr><td class="h">401</td><td colspan="7"></td></tr><tr><td class="h">402</td><td><div class="c3">32</div></td><td></td><td></td><td></td><td></td><td><div>15</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $id = $container_id;</td></tr>
<tr><td class="h">403</td><td><div class="c3">32</div></td><td></td><td></td><td></td><td></td><td><div>26</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $loc = $cell-&gt;{&#39;input_location&#39;};</td></tr>
<tr><td class="h">404</td><td><div class="c3">32</div></td><td></td><td></td><td></td><td></td><td><div>21</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $sample_volume = $cell-&gt;{&#39;sample_volume&#39;};</td></tr>
<tr><td class="h">405</td><td><div class="c3">32</div></td><td></td><td></td><td></td><td></td><td><div>19</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $buffer_volume = $cell-&gt;{&#39;buffer_volume&#39;};</td></tr>
<tr><td class="h">406</td><td><div class="c3">32</div></td><td></td><td></td><td></td><td></td><td><div>178</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $loc.&quot;\n&quot;.$id.&quot;\nv&quot;.(ceil($sample_volume)).&#39; b&#39;.(ceil($buffer_volume));</td></tr>
<tr><td class="h">407</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">408</td><td colspan="7"></td></tr><tr><td class="h">409</td><td><div class="c3">256</div></td><td></td><td></td><td></td><td></td><td><div>204</div></td><td class="s">&nbsp;&nbsp;return q{};</td></tr>
<tr><td class="h">410</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">411</td><td colspan="7"></td></tr><tr><td class="h">412</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _get_legend_content {</td></tr>
<tr><td class="h">413</td><td><div class="c3">144</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-wtsi_clarity-epp-generic-worksheet_attacher-pm--subroutine.html#L413">144</a></div></td><td></td><td><div>2339</div></td><td class="s">&nbsp;&nbsp;my ($i, $j) = @_;</td></tr>
<tr><td class="h">414</td><td><div class="c3">144</div></td><td><div class="c3" title="T/F"><a href="blib-lib-wtsi_clarity-epp-generic-worksheet_attacher-pm--branch.html#L414">100</a></div></td><td><div class="c3"><a href="blib-lib-wtsi_clarity-epp-generic-worksheet_attacher-pm--condition.html#L414">100</a></div></td><td></td><td></td><td><div>255</div></td><td class="s">&nbsp;&nbsp;if ($i == 0 || $i &gt; $NUMBER_OF_COLUMNS) {</td></tr>
<tr><td class="h">415</td><td><div class="c3">67</div></td><td><div class="c3" title="T/F"><a href="blib-lib-wtsi_clarity-epp-generic-worksheet_attacher-pm--branch.html#L415">100</a></div></td><td><div class="c3"><a href="blib-lib-wtsi_clarity-epp-generic-worksheet_attacher-pm--condition.html#L415">100</a></div></td><td></td><td></td><td><div>118</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($j == 0 || $j &gt; $NUMBER_OF_ROWS) {</td></tr>
<tr><td class="h">416</td><td><div class="c3">16</div></td><td></td><td></td><td></td><td></td><td><div>20</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return q{};</td></tr>
<tr><td class="h">417</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">418</td><td><div class="c3">51</div></td><td></td><td></td><td></td><td></td><td><div>71</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return &quot;.\n&quot;.chr($A_CHAR_CODE + $j).&quot;\n.&quot;;</td></tr>
<tr><td class="h">419</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">420</td><td><div class="c3">77</div></td><td><div class="c3" title="T/F"><a href="blib-lib-wtsi_clarity-epp-generic-worksheet_attacher-pm--branch.html#L420">100</a></div></td><td><div class="c3"><a href="blib-lib-wtsi_clarity-epp-generic-worksheet_attacher-pm--condition.html#L420">100</a></div></td><td></td><td></td><td><div>114</div></td><td class="s">&nbsp;&nbsp;if ($j == 0 || $j &gt; $NUMBER_OF_ROWS) {</td></tr>
<tr><td class="h">421</td><td><div class="c3">75</div></td><td></td><td></td><td></td><td></td><td><div>66</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $i;</td></tr>
<tr><td class="h">422</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">423</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;return;</td></tr>
<tr><td class="h">424</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">425</td><td colspan="7"></td></tr><tr><td class="h">426</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _get_cell_properties {</td></tr>
<tr><td class="h">427</td><td><div class="c3">298</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-wtsi_clarity-epp-generic-worksheet_attacher-pm--subroutine.html#L427">298</a></div></td><td></td><td><div>2206</div></td><td class="s">&nbsp;&nbsp;my ($data, $colour_indexes, $pos) = @_;</td></tr>
<tr><td class="h">428</td><td><div class="c3">298</div></td><td></td><td></td><td></td><td></td><td><div>309</div></td><td class="s">&nbsp;&nbsp;my $id = $data-&gt;{$pos}-&gt;{&#39;input_id&#39;};</td></tr>
<tr><td class="h">429</td><td><div class="c3">298</div></td><td><div class="c3" title="T/F"><a href="blib-lib-wtsi_clarity-epp-generic-worksheet_attacher-pm--branch.html#L429">100</a></div></td><td></td><td></td><td></td><td><div>210</div></td><td class="s">&nbsp;&nbsp;if (defined $id) {</td></tr>
<tr><td class="h">430</td><td><div class="c3">41</div></td><td></td><td></td><td></td><td></td><td><div>26</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $col = $colour_indexes-&gt;{$id};</td></tr>
<tr><td class="h">431</td><td><div class="c3">41</div></td><td></td><td></td><td></td><td></td><td><div>55</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return &quot;COLOUR_$col&quot;;</td></tr>
<tr><td class="h">432</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">433</td><td><div class="c3">257</div></td><td></td><td></td><td></td><td></td><td><div>231</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return &#39;EMPTY_STYLE&#39;</td></tr>
<tr><td class="h">434</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">435</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">436</td><td colspan="7"></td></tr><tr><td class="h">437</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _get_legend_properties {</td></tr>
<tr><td class="h">438</td><td><div class="c3">139</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-wtsi_clarity-epp-generic-worksheet_attacher-pm--subroutine.html#L438">139</a></div></td><td></td><td><div>2980</div></td><td class="s">&nbsp;&nbsp;return &#39;HEADER_STYLE&#39;;</td></tr>
<tr><td class="h">439</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">440</td><td colspan="7"></td></tr><tr><td class="h">441</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _get_colour_indexes {</td></tr>
<tr><td class="h">442</td><td><div class="c3">4</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-wtsi_clarity-epp-generic-worksheet_attacher-pm--subroutine.html#L442">4</a></div></td><td></td><td><div>191</div></td><td class="s">&nbsp;&nbsp;my ($data) = @_;</td></tr>
<tr><td class="h">443</td><td><div class="c3">4</div></td><td></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;my $hash_colour = {};</td></tr>
<tr><td class="h">444</td><td><div class="c3">4</div></td><td></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;my $colour_index = 0;</td></tr>
<tr><td class="h">445</td><td><div class="c3">4</div><div class="c3">4</div></td><td></td><td></td><td></td><td></td><td><div>2</div><div>22</div></td><td class="s">&nbsp;&nbsp;foreach my $key (sort keys %{$data}) {</td></tr>
<tr><td class="h">446</td><td><div class="c3">43</div></td><td></td><td></td><td></td><td></td><td><div>40</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $id = $data-&gt;{$key}-&gt;{&#39;input_id&#39;};</td></tr>
<tr><td class="h">447</td><td><div class="c3">43</div></td><td><div class="c3" title="T/F"><a href="blib-lib-wtsi_clarity-epp-generic-worksheet_attacher-pm--branch.html#L447">100</a></div></td><td><div class="c3"><a href="blib-lib-wtsi_clarity-epp-generic-worksheet_attacher-pm--condition.html#L447">100</a></div></td><td></td><td></td><td><div>82</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if (defined $id &amp;&amp; !defined $hash_colour-&gt;{$id}) {</td></tr>
<tr><td class="h">448</td><td><div class="c3">7</div></td><td></td><td></td><td></td><td></td><td><div>10</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$hash_colour-&gt;{$id} = $colour_index++;</td></tr>
<tr><td class="h">449</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">450</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">451</td><td><div class="c3">4</div></td><td></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;return $hash_colour;</td></tr>
<tr><td class="h">452</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">453</td><td colspan="7"></td></tr><tr><td class="h">454</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _get_location {</td></tr>
<tr><td class="h">455</td><td><div class="c3">434</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-wtsi_clarity-epp-generic-worksheet_attacher-pm--subroutine.html#L455">434</a></div></td><td></td><td><div>5760</div></td><td class="s">&nbsp;&nbsp;my ($i, $j) = @_;</td></tr>
<tr><td class="h">456</td><td><div class="c3">434</div></td><td><div class="c3" title="T/F"><a href="blib-lib-wtsi_clarity-epp-generic-worksheet_attacher-pm--branch.html#L456">100</a></div></td><td><div class="c3"><a href="blib-lib-wtsi_clarity-epp-generic-worksheet_attacher-pm--condition.html#L456">100</a></div></td><td></td><td></td><td><div>857</div></td><td class="s">&nbsp;&nbsp;if ($i == 0 || $i &gt; $NUMBER_OF_COLUMNS) {</td></tr>
<tr><td class="h">457</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# top or bottom row</td></tr>
<tr><td class="h">458</td><td><div class="c3">65</div></td><td></td><td></td><td></td><td></td><td><div>69</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return;</td></tr>
<tr><td class="h">459</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">460</td><td><div class="c3">369</div></td><td><div class="c3" title="T/F"><a href="blib-lib-wtsi_clarity-epp-generic-worksheet_attacher-pm--branch.html#L460">100</a></div></td><td><div class="c3"><a href="blib-lib-wtsi_clarity-epp-generic-worksheet_attacher-pm--condition.html#L460">100</a></div></td><td></td><td></td><td><div>601</div></td><td class="s">&nbsp;&nbsp;if ($j == 0 || $j &gt; $NUMBER_OF_ROWS) {</td></tr>
<tr><td class="h">461</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# top or bottom row</td></tr>
<tr><td class="h">462</td><td><div class="c3">77</div></td><td></td><td></td><td></td><td></td><td><div>62</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return;</td></tr>
<tr><td class="h">463</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">464</td><td><div class="c3">292</div></td><td></td><td></td><td></td><td></td><td><div>466</div></td><td class="s">&nbsp;&nbsp;return (chr $A_CHAR_CODE + $j).q{:}.$i;</td></tr>
<tr><td class="h">465</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">466</td><td colspan="7"></td></tr><tr><td class="h">467</td><td colspan="7"></td></tr><tr><td class="h">468</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _get_containers_data {</td></tr>
<tr><td class="h">469</td><td><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-wtsi_clarity-epp-generic-worksheet_attacher-pm--subroutine.html#L469">1</a></div></td><td></td><td><div>3245</div></td><td class="s">&nbsp;&nbsp;my ($self) = @_;</td></tr>
<tr><td class="h">470</td><td colspan="7"></td></tr><tr><td class="h">471</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;my $artifacts_tmp = $self-&gt;fetch_targets_hash($ARTIFACT_PATH);</td></tr>
<tr><td class="h">472</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;my $previous_processes = $self-&gt;fetch_targets_hash($PREVIOUS_PROC);</td></tr>
<tr><td class="h">473</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;my $previous_artifacts = $self-&gt;fetch_targets_hash($PREVIOUS_PROC, $ARTIFACT_PATH);</td></tr>
<tr><td class="h">474</td><td colspan="7"></td></tr><tr><td class="h">475</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;my $oi_map = $self-&gt;_get_oi_map($previous_processes);</td></tr>
<tr><td class="h">476</td><td colspan="7"></td></tr><tr><td class="h">477</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>2</div></td><td class="s">&nbsp;&nbsp;my $all_data = {};</td></tr>
<tr><td class="h">478</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>23</div></td><td class="s">&nbsp;&nbsp;my $process_id = $self-&gt;find_elements_first_value($self-&gt;process_doc-&gt;xml, $PROCESS_ID_PATH);</td></tr>
<tr><td class="h">479</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;$process_id =~ s/\-//xms;</td></tr>
<tr><td class="h">480</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;$all_data-&gt;{ q{process_id} } = $process_id;</td></tr>
<tr><td class="h">481</td><td colspan="7"></td></tr><tr><td class="h">482</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>25</div></td><td class="s">&nbsp;&nbsp;$all_data-&gt;{ q{user_first_name} } = $self-&gt;find_elements_first_value($self-&gt;process_doc-&gt;xml, $TECHNICIAN_FIRSTNAME_PATH);</td></tr>
<tr><td class="h">483</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>25</div></td><td class="s">&nbsp;&nbsp;$all_data-&gt;{ q{user_last_name}&nbsp;&nbsp;} = $self-&gt;find_elements_first_value($self-&gt;process_doc-&gt;xml, $TECHNICIAN_LASTNAME_PATH);</td></tr>
<tr><td class="h">484</td><td colspan="7"></td></tr><tr><td class="h">485</td><td><div class="c3">1</div><div class="c3">74</div></td><td></td><td></td><td></td><td></td><td><div>2</div><div>163</div></td><td class="s">&nbsp;&nbsp;while (my ($uri, $out_artifact) = each %{$artifacts_tmp} ) {</td></tr>
<tr><td class="h">486</td><td><div class="c3">73</div></td><td><div class="c0" title="T/-"><a href="blib-lib-wtsi_clarity-epp-generic-worksheet_attacher-pm--branch.html#L486">50</a></div></td><td></td><td></td><td></td><td><div>235</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($uri =~ /(.*)[?].*/xms) {</td></tr>
<tr><td class="h">487</td><td><div class="c3">73</div></td><td></td><td></td><td></td><td></td><td><div>164</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $in_artifact = $previous_artifacts-&gt;{$oi_map-&gt;{$uri}};</td></tr>
<tr><td class="h">488</td><td colspan="7"></td></tr><tr><td class="h">489</td><td><div class="c3">73</div></td><td></td><td></td><td></td><td></td><td><div>891</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $out_location = $self-&gt;find_elements_first_textContent( $out_artifact, $LOCATION_PATH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">490</td><td><div class="c3">73</div></td><td></td><td></td><td></td><td></td><td><div>472</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $out_container_uri = $self-&gt;find_elements_first_value&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;( $out_artifact, $CONTAINER_URI_PATH&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">491</td><td><div class="c3">73</div></td><td></td><td></td><td></td><td></td><td><div>92</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $out_container_id = $self-&gt;find_elements_first_value&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;( $out_artifact, $CONTAINER_ID_PATH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">492</td><td><div class="c3">73</div></td><td></td><td></td><td></td><td></td><td><div>95</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $sample_volume = $self-&gt;find_udf_element_textContent&nbsp;&nbsp;&nbsp;( $out_artifact, $SAMPLE_VOLUME_PATH, 0 );</td></tr>
<tr><td class="h">493</td><td><div class="c3">73</div></td><td></td><td></td><td></td><td></td><td><div>455</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $buffer_volume = $self-&gt;find_udf_element_textContent&nbsp;&nbsp;&nbsp;( $out_artifact, $BUFFER_VOLUME_PATH, 0 );</td></tr>
<tr><td class="h">494</td><td><div class="c3">73</div></td><td></td><td></td><td></td><td></td><td><div>457</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $in_location = $self-&gt;find_elements_first_textContent( $in_artifact, $LOCATION_PATH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">495</td><td><div class="c3">73</div></td><td></td><td></td><td></td><td></td><td><div>459</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $in_container_uri = $self-&gt;find_elements_first_value&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;( $in_artifact, $CONTAINER_URI_PATH&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">496</td><td colspan="7"></td></tr><tr><td class="h">497</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# we only do this part when it&#39;s a container that we don&#39;t know yet...</td></tr>
<tr><td class="h">498</td><td><div class="c3">73</div></td><td><div class="c3" title="T/F"><a href="blib-lib-wtsi_clarity-epp-generic-worksheet_attacher-pm--branch.html#L498">100</a></div></td><td></td><td></td><td></td><td><div>141</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (!defined $all_data-&gt;{&#39;output_container_info&#39;}-&gt;{$out_container_uri})</td></tr>
<tr><td class="h">499</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr>
<tr><td class="h">500</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $out_container = $self-&gt;fetch_and_parse($out_container_uri);</td></tr>
<tr><td class="h">501</td><td colspan="7"></td></tr><tr><td class="h">502</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>259</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $barcode = $self-&gt;find_clarity_element_textContent($out_container, q{name}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">503</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>9</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $purpose = $self-&gt;find_udf_element_textContent&nbsp;&nbsp;&nbsp;&nbsp;($out_container, $PURPOSE_PATH, q{Unknown} );</td></tr>
<tr><td class="h">504</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $name = $out_container_id;</td></tr>
<tr><td class="h">505</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$name =~ s/\-//xms;</td></tr>
<tr><td class="h">506</td><td colspan="7"></td></tr><tr><td class="h">507</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# to get the wells</td></tr>
<tr><td class="h">508</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $out_container_type_uri = $self-&gt;find_elements_first_value($out_container, $CONTAINER_TYPE_URI );</td></tr>
<tr><td class="h">509</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>2</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $out_container_type_name = $self-&gt;find_elements_first_value($out_container, $CONTAINER_TYPE_NAME);</td></tr>
<tr><td class="h">510</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $out_container_type = $self-&gt;fetch_and_parse($out_container_type_uri);</td></tr>
<tr><td class="h">511</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>75</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $x = $self-&gt;find_elements_first_textContent($out_container_type, $CONTAINER_TYPE_X);</td></tr>
<tr><td class="h">512</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>9</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $y = $self-&gt;find_elements_first_textContent($out_container_type, $CONTAINER_TYPE_Y);</td></tr>
<tr><td class="h">513</td><td colspan="7"></td></tr><tr><td class="h">514</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>10</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$all_data-&gt;{ q{output_container_info} }-&gt;{ $out_container_uri }-&gt;{ q{purpose}&nbsp;&nbsp;&nbsp;&nbsp;} = $purpose;</td></tr>
<tr><td class="h">515</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$all_data-&gt;{ q{output_container_info} }-&gt;{ $out_container_uri }-&gt;{ q{plate_name} } = $name;</td></tr>
<tr><td class="h">516</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>2</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$all_data-&gt;{ q{output_container_info} }-&gt;{ $out_container_uri }-&gt;{ q{barcode}&nbsp;&nbsp;&nbsp;&nbsp;} = $barcode;</td></tr>
<tr><td class="h">517</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>2</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$all_data-&gt;{ q{output_container_info} }-&gt;{ $out_container_uri }-&gt;{ q{type}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} = $out_container_type_name;</td></tr>
<tr><td class="h">518</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>37</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$all_data-&gt;{ q{output_container_info} }-&gt;{ $out_container_uri }-&gt;{ q{wells}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} = $x * $y;</td></tr>
<tr><td class="h">519</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">520</td><td colspan="7"></td></tr><tr><td class="h">521</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# we only do this part when it&#39;s a container that we don&#39;t know yet...</td></tr>
<tr><td class="h">522</td><td><div class="c3">73</div></td><td><div class="c3" title="T/F"><a href="blib-lib-wtsi_clarity-epp-generic-worksheet_attacher-pm--branch.html#L522">100</a></div></td><td></td><td></td><td></td><td><div>97</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (!defined $all_data-&gt;{&#39;input_container_info&#39;}-&gt;{$in_container_uri}) {</td></tr>
<tr><td class="h">523</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $in_container = $self-&gt;fetch_and_parse($in_container_uri);</td></tr>
<tr><td class="h">524</td><td colspan="7"></td></tr><tr><td class="h">525</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td></td><td><div>488</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $freezer = $self-&gt;find_udf_element_textContent( $in_container, $FREEZER_PATH, q{Unknown} );</td></tr>
<tr><td class="h">526</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td></td><td><div>15</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $shelf = $self-&gt;find_udf_element_textContent( $in_container, $SHELF_PATH, q{Unknown} );</td></tr>
<tr><td class="h">527</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td></td><td><div>15</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $tray = $self-&gt;find_udf_element_textContent( $in_container, $TRAY_PATH, q{Unknown} );</td></tr>
<tr><td class="h">528</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td></td><td><div>14</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $rack = $self-&gt;find_udf_element_textContent( $in_container, $RACK_PATH, q{Unknown} );</td></tr>
<tr><td class="h">529</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td></td><td><div>13</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $purpose = $self-&gt;find_udf_element_textContent( $in_container, $PURPOSE_PATH, q{Unknown} );</td></tr>
<tr><td class="h">530</td><td colspan="7"></td></tr><tr><td class="h">531</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td></td><td><div>14</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $barcode = $self-&gt;find_clarity_element_textContent($in_container, q{name});</td></tr>
<tr><td class="h">532</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td></td><td><div>14</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $type_name = $self-&gt;find_elements_first_value($in_container, $CONTAINER_TYPE_NAME);</td></tr>
<tr><td class="h">533</td><td colspan="7"></td></tr><tr><td class="h">534</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td></td><td><div>1</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $plate_name;</td></tr>
<tr><td class="h">535</td><td><div class="c3">2</div></td><td><div class="c0" title="T/-"><a href="blib-lib-wtsi_clarity-epp-generic-worksheet_attacher-pm--branch.html#L535">50</a></div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (length $barcode == $EAN13_BARCODE_LENGTH) {</td></tr>
<tr><td class="h">536</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$plate_name = substr $barcode, $PLATE_NAME_START_INDEX, $PLATE_NAME_START_LENGTH;</td></tr>
<tr><td class="h">537</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$plate_name =~ s/^0*//xms;</td></tr>
<tr><td class="h">538</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">539</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$plate_name = $barcode;</td></tr>
<tr><td class="h">540</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">541</td><td colspan="7"></td></tr><tr><td class="h">542</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$all_data-&gt;{ q{input_container_info} }-&gt;{ $in_container_uri }-&gt;{ q{plate_name} } = $plate_name;</td></tr>
<tr><td class="h">543</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$all_data-&gt;{ q{input_container_info} }-&gt;{ $in_container_uri }-&gt;{ q{barcode}&nbsp;&nbsp;&nbsp;&nbsp;} = $barcode;</td></tr>
<tr><td class="h">544</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$all_data-&gt;{ q{input_container_info} }-&gt;{ $in_container_uri }-&gt;{ q{type}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} = $type_name;</td></tr>
<tr><td class="h">545</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$all_data-&gt;{ q{input_container_info} }-&gt;{ $in_container_uri }-&gt;{ q{freezer}&nbsp;&nbsp;&nbsp;&nbsp;} = $freezer;</td></tr>
<tr><td class="h">546</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$all_data-&gt;{ q{input_container_info} }-&gt;{ $in_container_uri }-&gt;{ q{shelf}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} = $shelf;</td></tr>
<tr><td class="h">547</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$all_data-&gt;{ q{input_container_info} }-&gt;{ $in_container_uri }-&gt;{ q{rack}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} = $rack;</td></tr>
<tr><td class="h">548</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$all_data-&gt;{ q{input_container_info} }-&gt;{ $in_container_uri }-&gt;{ q{tray}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} = $tray;</td></tr>
<tr><td class="h">549</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td></td><td><div>69</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$all_data-&gt;{ q{input_container_info} }-&gt;{ $in_container_uri }-&gt;{ q{purpose}&nbsp;&nbsp;&nbsp;&nbsp;} = $purpose;</td></tr>
<tr><td class="h">550</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">551</td><td colspan="7"></td></tr><tr><td class="h">552</td><td><div class="c3">73</div></td><td></td><td></td><td></td><td></td><td><div>77</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $plate_name = $all_data-&gt;{q{input_container_info}}-&gt;{ $in_container_uri }-&gt;{q{plate_name}};</td></tr>
<tr><td class="h">553</td><td><div class="c3">73</div></td><td></td><td></td><td></td><td></td><td><div>307</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$all_data-&gt;{ q{output_container_info} }-&gt;{$out_container_uri}-&gt;{ q{container_details} }-&gt;{$out_location} = {</td></tr>
<tr><td class="h">554</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;q{input_id}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; $plate_name,</td></tr>
<tr><td class="h">555</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;q{input_location}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; $in_location,</td></tr>
<tr><td class="h">556</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;q{sample_volume}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; $sample_volume,</td></tr>
<tr><td class="h">557</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;q{buffer_volume}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; $buffer_volume,</td></tr>
<tr><td class="h">558</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;q{input_uri}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; $in_container_uri,</td></tr>
<tr><td class="h">559</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};</td></tr>
<tr><td class="h">560</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">561</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">562</td><td colspan="7"></td></tr><tr><td class="h">563</td><td><div class="c3">1</div><div class="c3">2</div></td><td></td><td></td><td></td><td></td><td><div>2</div><div>5</div></td><td class="s">&nbsp;&nbsp;while (my ($uri, $out_artifact) = each %{$all_data-&gt;{ q{output_container_info} }}) {</td></tr>
<tr><td class="h">564</td><td><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>2</div><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$out_artifact-&gt;{ q{occ_wells} } = scalar keys %{$out_artifact-&gt;{ q{container_details} }};</td></tr>
<tr><td class="h">565</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">566</td><td colspan="7"></td></tr><tr><td class="h">567</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>15</div></td><td class="s">&nbsp;&nbsp;return $all_data;</td></tr>
<tr><td class="h">568</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">569</td><td colspan="7"></td></tr><tr><td class="h">570</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">has &#39;_oi_map&#39; =&gt; (</td></tr>
<tr><td class="h">571</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;isa&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; &#39;HashRef&#39;,</td></tr>
<tr><td class="h">572</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;is&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; &#39;rw&#39;,</td></tr>
<tr><td class="h">573</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;required&nbsp;&nbsp;&nbsp;=&gt; 0,</td></tr>
<tr><td class="h">574</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;default =&gt; sub {</td></tr>
<tr><td class="h">575</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;{}</td></tr>
<tr><td class="h">576</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;},</td></tr>
<tr><td class="h">577</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">);</td></tr>
<tr><td class="h">578</td><td colspan="7"></td></tr><tr><td class="h">579</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _get_oi_map {</td></tr>
<tr><td class="h">580</td><td><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-wtsi_clarity-epp-generic-worksheet_attacher-pm--subroutine.html#L580">1</a></div></td><td></td><td><div>2</div></td><td class="s">&nbsp;&nbsp;my ($self, $previous_processes) = @_;</td></tr>
<tr><td class="h">581</td><td colspan="7"></td></tr><tr><td class="h">582</td><td><div class="c3">1</div><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="blib-lib-wtsi_clarity-epp-generic-worksheet_attacher-pm--branch.html#L582">50</a></div></td><td></td><td></td><td></td><td><div>1</div><div>36</div></td><td class="s">&nbsp;&nbsp;if (keys %{$self-&gt;_oi_map}) {</td></tr>
<tr><td class="h">583</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $self-&gt;_oi_map;</td></tr>
<tr><td class="h">584</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">585</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>2</div></td><td class="s">&nbsp;&nbsp;my $oi_map = {};</td></tr>
<tr><td class="h">586</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;## no critic(ValuesAndExpressions::RequireInterpolationOfMetachars)</td></tr>
<tr><td class="h">587</td><td><div class="c3">1</div><div class="c3">2</div></td><td></td><td></td><td></td><td></td><td><div>2</div><div>256</div></td><td class="s">&nbsp;&nbsp;while (my ($uri, $proc) = each %{$previous_processes} ) {</td></tr>
<tr><td class="h">588</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $proc_io_maps = $self-&gt;find_elements($proc, q{./input-output-map});</td></tr>
<tr><td class="h">589</td><td><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>138</div><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;foreach my $proc_io_map (@{$proc_io_maps}) {</td></tr>
<tr><td class="h">590</td><td><div class="c3">73</div></td><td></td><td></td><td></td><td></td><td><div>816</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $in = $proc_io_map-&gt;findnodes( q{./input/@uri}&nbsp;&nbsp;);</td></tr>
<tr><td class="h">591</td><td><div class="c3">73</div></td><td></td><td></td><td></td><td></td><td><div>1272</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $out = $proc_io_map-&gt;findnodes( q{./output/@uri} );</td></tr>
<tr><td class="h">592</td><td><div class="c3">73</div></td><td></td><td></td><td></td><td></td><td><div>1152</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$oi_map-&gt;{$out} = $in;</td></tr>
<tr><td class="h">593</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">594</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">595</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;## use critic</td></tr>
<tr><td class="h">596</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>35</div></td><td class="s">&nbsp;&nbsp;$self-&gt;_oi_map($oi_map);</td></tr>
<tr><td class="h">597</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>27</div></td><td class="s">&nbsp;&nbsp;return $self-&gt;_oi_map;</td></tr>
<tr><td class="h">598</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">599</td><td colspan="7"></td></tr><tr><td class="h">600</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">1;</td></tr>
<tr><td class="h">601</td><td colspan="7"></td></tr></table>
</body>
</html>
